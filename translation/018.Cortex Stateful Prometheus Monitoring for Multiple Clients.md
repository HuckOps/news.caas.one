# Cortex：Prometheus 针对多个客户端状态的监控

虽然云原生社区中的许多人都称赞监控工具Prometheus的易用性，但它并不是为永久存储操作数据而设计的，也不能用于多个客户机。现在，Weaveworks公司的一个名为Cortex的项目将Prometheus打包来解决这个问题，为那些想要提供Prometheus服务的服务提供商提供长期的分布式数据存储和多用户服务。

上周，云原生计算基金会（CNCF）将Cortex纳入云原生项目的基地CNCF Sandbox。

Weaveworks最初开发Cortex是为了支持自己的商业云服务Weave cloud。Prometheus是一个用于收集、显示和分析从IT资源中收集的时间数据序列的监测和警报工具包。

![img](https://cdn.thenewstack.io/media/2018/09/1731daec-cortex-768x511.png)

最初，Weaveworks公司通过Kubernetes ReplicaSets部署了多个Prometheus副本，但这种方法有很多限制。为此，Weaveworks工程副总裁 Jonathan Lange在博客中解释道：”我们没有做好长期储存的准备，不管是Prometheus系统崩溃了，或者是我们升级Prometheus的版本，又或者是我们改变了警报规则，我们都将失去时间序列数据。“

Weaveworks营销副总裁 Sonja Schweigert表示，Cortex可以被视为一种提供“Prometheus-as-a-Service”的方式。

Cortex为Prometheus查询提供了一个完全兼容的API(使用PromQL)，用户可以由多个客户端或业务线为自己的工作负载使用该API，它可以横向扩展，这意味着一个部署能够管理来自许多系统的数十万个度量。这种方法避免了为每个客户维护一个单独的Prometheus副本的管理麻烦。

而且，与Prometheus本身不同，Cortex受到Amazon Dynamo架构的启发，能提供数据的长期保存，它定期捆绑性能样本，并定期将写入分布式存储后端，如DynamoDB、BigTable或Cassandra。

除了Weaveworks本身，Grafana Labs、FreshTracks和EA也使用Cortex。